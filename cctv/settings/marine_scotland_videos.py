import os, sys

from . import marine_scotland_settings

__author__ = 'gfrench'



ALL_VIDEO_NAMES = [
    'ABSENT-ABSENT-120727_093629-C3W-029-120902_125401_590',
    'ABSENT-ABSENT-120727_093629-C3W-030-120902_145401_413',
    'ABSENT-ABSENT-120727_093629-C3W-033-120902_205400_993',
    'ABSENT-ABSENT-120727_093629-C3W-042-120903_145400_794',
    'ABSENT-ABSENT-120727_093629-C3W-077-120906_125359_025',
    'ABSENT-ABSENT-121007_233613-C1W-015-121015_105111_159',
    'ABSENT-ABSENT-121007_233613-C1W-052-121018_125110_599',
    'ABSENT-ABSENT-121007_233613-C1W-093-121026_155958_167',
    'ABSENT-ABSENT-121025_083010-C2W-021-121027_054820_047',
    'ABSENT-ABSENT-121025_083010-C2W-022-121027_074818_748',
    'ABSENT-ABSENT-121025_083010-C2W-028-121027_194820_499',
    'ABSENT-ABSENT-121025_083010-C2W-029-121027_214819_621',
    'ABSENT-ABSENT-121102_091058-C1W-017-121106_215319_303',
    'ABSENT-ABSENT-121102_091058-C1W-020-121107_035319_397',
    'ABSENT-ABSENT-121102_091058-C1W-023-121107_095319_597',
    'ABSENT-ABSENT-121102_124430-C1W-028-121105_140236_425',
    'ABSENT-ABSENT-121102_124430-C1W-036-121106_060234_429',
    'ABSENT-ABSENT-121102_124430-C1W-046-121107_014106_961',
    'ABSENT-ABSENT-121102_124430-C1W-049-121107_074107_119',
    'ABSENT-ABSENT-121203_100927-C1W-008-121206_112419_299',
    'ABSENT-ABSENT-121203_100927-C1W-010-121206_152419_756',
    'ABSENT-ABSENT-121203_100927-C1W-034-121208_104702_995',
    'ABSENT-ABSENT-121203_100927-C1W-037-121208_164703_646',
    'ABSENT-ABSENT-121203_100927-C1W-061-121212_105946_017',
    'ABSENT-ABSENT-121203_100927-C1W-062-121212_125945_910',
    'ABSENT-ABSENT-121211_100947-C2W-024-121213_131631_877',
    'ABSENT-ABSENT-121211_100947-C2W-028-121213_211631_599',
    'ABSENT-ABSENT-121211_100947-C2W-077-121217_231629_659',
    'ABSENT-ABSENT-130801_074644-C3H-072-130818_225949_035',
    'ABSENT-ABSENT-130801_074644-C3H-075-130818_235950_233',
    'ABSENT-ABSENT-130801_074644-C3H-083-130802_215624_497',
    'BOYJOH-ABSENT-121010_111427-C1W-069-121016_211429_654',
    'BOYJOH-ABSENT-121010_111427-C1W-104-121020_060043_204',
    'BOYJOH-ABSENT-121010_111427-C1W-111-121020_200041_838',
    'BOYJOH-ABSENT-121010_111427-C1W-133-121022_160041_664',
    'CQ2013-000RED-130902_074321-C4H-021-130903_195139_219',
    'CQ2013-000RED-130902_074321-C4H-025-130903_205140_478',
    'CQ2013-000RED-130902_074321-C4H-045-130904_015146_259',
    'CQ2013-000RED-130902_074321-C4H-049-130904_025147_497',
    'CQ2013-000RED-130902_074321-C4H-059-130922_190827_456',
    'CQ2013-000RED-130902_074321-C4H-065-130904_065152_310',
    'CQ2013-LUNAR2-130723_095202-C3H-099-130807_110622_029',
    'CQ2013-LUNAR2-130723_095202-C3H-111-130807_140625_520',
    'CQ2013-LUNAR2-130723_095202-C3H-115-130807_150626_698',
    'CQ2013-LUNAR2-130723_095202-C3H-143-130807_220634_946',
    'CQ2013-LUNAR2-130723_095202-C3H-239-130808_220703_153',
    'CQ2013-LUNAR2-130723_095202-C3H-445-130812_165225_068',
    'RYANWO-OOD000-121112_223212-C3W-016-121123_021007_938',
    'RYANWO-OOD000-121112_223212-C3W-023-121123_161007_649',
    'RYANWO-OOD000-121112_223212-C3W-029-121124_041006_235',
    'RYANWO-OOD000-121112_223212-C3W-035-121124_161005_322',
    'RYANWO-OOD000-121112_223212-C3W-045-121125_121004_050'
]


UNUSABLE_VIDEO_NAMES = [
    # STRUCTURAL OCCLUSION
    'ABSENT-ABSENT-121007_233613-C1W-093-121026_155958_167', # best view of belt
    'ABSENT-ABSENT-121007_233613-C1W-015-121015_105111_159',
    'ABSENT-ABSENT-121007_233613-C1W-052-121018_125110_599'

    # CAMERA NOT SECURELY FIXED; MOTION OF CAMERA CONFUSES MOTION TRACKER
    # MAJOR STRUCTURAL OCCLUSION
    'ABSENT-ABSENT-121203_100927-C1W-008-121206_112419_299',
    'ABSENT-ABSENT-121203_100927-C1W-010-121206_152419_756', # 10 frames no motion
    'ABSENT-ABSENT-121203_100927-C1W-034-121208_104702_995',
    'ABSENT-ABSENT-121203_100927-C1W-037-121208_164703_646',
    'ABSENT-ABSENT-121203_100927-C1W-061-121212_105946_017',
    'ABSENT-ABSENT-121203_100927-C1W-062-121212_125945_910',

    # MAJOR STRUCTURAL OCCLUSION
    'CQ2013-000RED-130902_074321-C4H-021-130903_195139_219',
    'CQ2013-000RED-130902_074321-C4H-025-130903_205140_478',
    'CQ2013-000RED-130902_074321-C4H-045-130904_015146_259',
    'CQ2013-000RED-130902_074321-C4H-049-130904_025147_497',
    'CQ2013-000RED-130902_074321-C4H-059-130922_190827_456',
    'CQ2013-000RED-130902_074321-C4H-065-130904_065152_310',
]


ALL_BELT_NAMES = [
    'ABSENT-ABSENT-120727_093629-C3W', #***
    'ABSENT-ABSENT-121007_233613-C1W', # STRUCTURAL OCCLUSION
    'ABSENT-ABSENT-121025_083010-C2W',
    'ABSENT-ABSENT-121102_091058-C1W',
    'ABSENT-ABSENT-121102_124430-C1W', #***
    'ABSENT-ABSENT-121203_100927-C1W', # MAJOR STRUCTURAL OCCLUSION
    'ABSENT-ABSENT-121211_100947-C2W',
    'ABSENT-ABSENT-130801_074644-C3H', #***
    'BOYJOH-ABSENT-121010_111427-C1W',
    'CQ2013-000RED-130902_074321-C4H', # MAJOR STRUCTURAL OCCLUSION
    'CQ2013-LUNAR2-130723_095202-C3H', #***
    'RYANWO-OOD000-121112_223212-C3W', #***
]


USABLE_BELT_NAMES = [
    'ABSENT-ABSENT-120727_093629-C3W',
    'ABSENT-ABSENT-121025_083010-C2W', # INCOMPLETE VIEW OF BELT
    'ABSENT-ABSENT-121102_091058-C1W',
    'ABSENT-ABSENT-121102_124430-C1W',
    'ABSENT-ABSENT-121211_100947-C2W',
    'ABSENT-ABSENT-130801_074644-C3H',
    'BOYJOH-ABSENT-121010_111427-C1W',
    'CQ2013-LUNAR2-130723_095202-C3H',
    'RYANWO-OOD000-121112_223212-C3W',
]


VIDEOS_BY_BELT = [
    [
        'ABSENT-ABSENT-120727_093629-C3W-033-120902_205400_993',  # best view of belt
        'ABSENT-ABSENT-120727_093629-C3W-029-120902_125401_590',
        'ABSENT-ABSENT-120727_093629-C3W-030-120902_145401_413',
        'ABSENT-ABSENT-120727_093629-C3W-042-120903_145400_794',
        'ABSENT-ABSENT-120727_093629-C3W-077-120906_125359_025'
    ],
    [
        'ABSENT-ABSENT-121007_233613-C1W-093-121026_155958_167', # best view of belt
        'ABSENT-ABSENT-121007_233613-C1W-015-121015_105111_159',
        'ABSENT-ABSENT-121007_233613-C1W-052-121018_125110_599'
    ],
    [
        'ABSENT-ABSENT-121025_083010-C2W-021-121027_054820_047', # best view of belt
        'ABSENT-ABSENT-121025_083010-C2W-022-121027_074818_748',
        'ABSENT-ABSENT-121025_083010-C2W-028-121027_194820_499',
        'ABSENT-ABSENT-121025_083010-C2W-029-121027_214819_621'
    ],
    [
        'ABSENT-ABSENT-121102_091058-C1W-017-121106_215319_303', # best view of belt
        'ABSENT-ABSENT-121102_091058-C1W-020-121107_035319_397',
        'ABSENT-ABSENT-121102_091058-C1W-023-121107_095319_597'
    ],
    [
        'ABSENT-ABSENT-121102_124430-C1W-049-121107_074107_119', # best view of belt
        'ABSENT-ABSENT-121102_124430-C1W-028-121105_140236_425',
        'ABSENT-ABSENT-121102_124430-C1W-036-121106_060234_429',
        'ABSENT-ABSENT-121102_124430-C1W-046-121107_014106_961'
    ],
    [
        'ABSENT-ABSENT-121203_100927-C1W-008-121206_112419_299', # best view of belt
        'ABSENT-ABSENT-121203_100927-C1W-010-121206_152419_756',
        'ABSENT-ABSENT-121203_100927-C1W-034-121208_104702_995',
        'ABSENT-ABSENT-121203_100927-C1W-037-121208_164703_646',
        'ABSENT-ABSENT-121203_100927-C1W-061-121212_105946_017',
        'ABSENT-ABSENT-121203_100927-C1W-062-121212_125945_910'
    ],
    [
        'ABSENT-ABSENT-121211_100947-C2W-028-121213_211631_599', # best view of belt
        'ABSENT-ABSENT-121211_100947-C2W-024-121213_131631_877',
        'ABSENT-ABSENT-121211_100947-C2W-077-121217_231629_659'
    ],
    [
        'ABSENT-ABSENT-130801_074644-C3H-083-130802_215624_497', # best view of belt
        'ABSENT-ABSENT-130801_074644-C3H-072-130818_225949_035',
        'ABSENT-ABSENT-130801_074644-C3H-075-130818_235950_233'
    ],
    [
        'BOYJOH-ABSENT-121010_111427-C1W-133-121022_160041_664', # best view of belt
        'BOYJOH-ABSENT-121010_111427-C1W-069-121016_211429_654',
        'BOYJOH-ABSENT-121010_111427-C1W-104-121020_060043_204',
        'BOYJOH-ABSENT-121010_111427-C1W-111-121020_200041_838'
    ],
    [
        'CQ2013-000RED-130902_074321-C4H-059-130922_190827_456', # best view of belt
        'CQ2013-000RED-130902_074321-C4H-021-130903_195139_219',
        'CQ2013-000RED-130902_074321-C4H-025-130903_205140_478',
        'CQ2013-000RED-130902_074321-C4H-045-130904_015146_259',
        'CQ2013-000RED-130902_074321-C4H-049-130904_025147_497',
        'CQ2013-000RED-130902_074321-C4H-065-130904_065152_310'
    ],
    [
        'CQ2013-LUNAR2-130723_095202-C3H-111-130807_140625_520', # best view of belt
        'CQ2013-LUNAR2-130723_095202-C3H-099-130807_110622_029',
        'CQ2013-LUNAR2-130723_095202-C3H-115-130807_150626_698',
        'CQ2013-LUNAR2-130723_095202-C3H-143-130807_220634_946',
        'CQ2013-LUNAR2-130723_095202-C3H-239-130808_220703_153',
        'CQ2013-LUNAR2-130723_095202-C3H-445-130812_165225_068'
    ],
    [
        'RYANWO-OOD000-121112_223212-C3W-023-121123_161007_649', # best view of belt
        'RYANWO-OOD000-121112_223212-C3W-016-121123_021007_938',
        'RYANWO-OOD000-121112_223212-C3W-029-121124_041006_235',
        'RYANWO-OOD000-121112_223212-C3W-035-121124_161005_322',
        'RYANWO-OOD000-121112_223212-C3W-045-121125_121004_050'
    ]
]


BELT_NAME_TO_VIDEO_NAMES = {belt_name: [v   for v in ALL_VIDEO_NAMES   if v.startswith(belt_name)]
                            for belt_name in ALL_BELT_NAMES}

VIDEO_NAME_TO_BELT_NAME = {}

for video_name in ALL_VIDEO_NAMES:
    for belt_name in ALL_BELT_NAMES:
        if video_name.startswith(belt_name):
            VIDEO_NAME_TO_BELT_NAME[video_name] = belt_name



BELT_WIDTH_ESTIMATES = {}

# BELT MEASUREMENTS:
#     'ABSENT-ABSENT-120727_093629-C3W' using 'labelimg__ABSENT-ABSENT-120727_093629-C3W-029-120902_125401_590__3' as reference
# Hand (20cm): 70px
# Belt width: 180px;  ~50cm  (360 px/m)
BELT_WIDTH_ESTIMATES['ABSENT-ABSENT-120727_093629-C3W'] = 0.50
#
#     'ABSENT-ABSENT-121007_233613-C1W' using 'labelimg__ABSENT-ABSENT-121007_233613-C1W-015-121015_105111_159__14665' and 'labelimg__ABSENT-ABSENT-121007_233613-C1W-015-121015_105111_159__15846' as reference
# Hand (20cm) at top of structure: 150px
# Belt width (at top of structure): 360px;, est 90% of width visible:  ~48cm  (1029 px/m)
BELT_WIDTH_ESTIMATES['ABSENT-ABSENT-121007_233613-C1W'] = 0.48
#
#     'ABSENT-ABSENT-121025_083010-C2W'; using 'labelimg__ABSENT-ABSENT-121025_083010-C2W-022-121027_074818_748__108' as reference
# Hand (20cm): 180px:
# Belt width (only part of belt visible, so taking the visible part): 360px;  ~48cm  (1161 px/m)
BELT_WIDTH_ESTIMATES['ABSENT-ABSENT-121025_083010-C2W'] = 0.48
#
#     'ABSENT-ABSENT-121102_091058-C1W'; using 'labelimg__ABSENT-ABSENT-121102_091058-C1W-023-121107_095319_597__165' as reference
# Hand (20cm) at top of structure: 130px
# Belt width (at top of structure): 325px
# Belt width (at bottom of structure): 295px;
# Projected hand: 120px:
# Visible belt width (at bottom of structure): 250px;  ~48cm (758 px/m)
BELT_WIDTH_ESTIMATES['ABSENT-ABSENT-121102_091058-C1W'] = 0.48
#
#     'ABSENT-ABSENT-121102_124430-C1W', using 'labelimg__ABSENT-ABSENT-121102_124430-C1W-028-121105_140236_425__432' as reference
# Hand (20cm): 75px
# Belt width: 165px;  ~35cm (471 px/m)
BELT_WIDTH_ESTIMATES['ABSENT-ABSENT-121102_124430-C1W'] = 0.50
#
#     'ABSENT-ABSENT-121211_100947-C2W', using 'labelimg__ABSENT-ABSENT-121211_100947-C2W-024-121213_131631_877__1555' as reference
# Hand (20cm): 105px
# Belt width: 330px;  ~49cm (673 px/m)
BELT_WIDTH_ESTIMATES['ABSENT-ABSENT-121211_100947-C2W'] = 0.49
#
#     'ABSENT-ABSENT-130801_074644-C3H', using measured width
# Measured belt width: 49.6cm with 49.6cm visible, 310px (625 px/m)
BELT_WIDTH_ESTIMATES['ABSENT-ABSENT-130801_074644-C3H'] = 0.496
#
#     'BOYJOH-ABSENT-121010_111427-C1W', using measured width
# Measured belt width: 50.5cm with est 49.5cm visible, 325px (655 px/m)
BELT_WIDTH_ESTIMATES['BOYJOH-ABSENT-121010_111427-C1W'] = 0.495
#
#     'CQ2013-LUNAR2-130723_095202-C3H', using measured width
# Measured belt width: 50cm with 50cm visible, 320px (640 px/m)
BELT_WIDTH_ESTIMATES['CQ2013-LUNAR2-130723_095202-C3H'] = 0.5
#
#     'RYANWO-OOD000-121112_223212-C3W', using 'labelimg__RYANWO-OOD000-121112_223212-C3W-023-121123_161007_649__1364' as reference
# Hand (20cm): 155px
# Belt width: 410px; ~25cm (1640 px/m)**
BELT_WIDTH_ESTIMATES['RYANWO-OOD000-121112_223212-C3W'] = 0.50





def video_filename(video_name):
    if sys.platform == 'darwin':
        return '{0}.mp4'.format(video_name)
    else:
        return '{0}.avi'.format(video_name)

def video_path(video_name):
    return os.path.join(marine_scotland_settings.VIDEO_PATH, video_filename(video_name))


def motion_path_for_video(video_path):
    video_dir, filename = os.path.split(video_path)
    motion_filename = os.path.splitext(filename)[0] + '__motion.npz'
    return os.path.join(video_dir, motion_filename)


def segmentation_path_for_video(video_name, seg_name, ext='.h5'):
    return os.path.join(marine_scotland_settings.VIDEO_OUTPUT_PATH, 'segmentation', seg_name,
                        '{}{}'.format(video_name, ext))



def belt_params_filename(video_name=None, belt_name=None):
    if video_name is None  and  belt_name is None:
        raise ValueError('Must supply either a video name or a belt name')

    if video_name is None:
        for v in ALL_VIDEO_NAMES:
            if v.startswith(belt_name):
                video_name = v
                break

    return '{0}__belt_params.mat'.format(video_name)

def belt_params_path(video_name=None, belt_name=None):
    if video_name is None  and  belt_name is None:
        raise ValueError('Must supply either a video name or a belt name')

    return os.path.join(marine_scotland_settings.BELT_PARAMS_PATH, belt_params_filename(video_name=video_name, belt_name=belt_name))




